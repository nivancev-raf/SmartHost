<div class="reservation-dialog">
  <div class="dialog-header">
    <h2 mat-dialog-title>Complete Your Reservation</h2>
    <button mat-icon-button mat-dialog-close class="close-button">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <div mat-dialog-content class="dialog-content">
    <!-- Booking Summary -->
    <div class="booking-summary">
      <h3>Booking Details</h3>
      <div class="apartment-info">
        <h4>{{ apartment.name }}</h4>
        <p class="location">
          <mat-icon>location_on</mat-icon>
          {{ apartment.address }}, {{ apartment.city }}
        </p>
      </div>
      
      <div class="booking-details">
        <div class="detail-row">
          <span class="label">Check-in:</span>
          <span class="value">{{ checkInFormatted }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Check-out:</span>
          <span class="value">{{ checkOutFormatted }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Guests:</span>
          <span class="value">{{ guests }} {{ guests === 1 ? 'guest' : 'guests' }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Nights:</span>
          <span class="value">{{ numberOfNights }} {{ numberOfNights === 1 ? 'night' : 'nights' }}</span>
        </div>
        <div class="detail-row total">
          <span class="label">Total:</span>
          <span class="value">â‚¬{{ totalPrice }}</span>
        </div>
      </div>
    </div>

    <!-- Guest Information Form -->
    <form [formGroup]="reservationForm" class="reservation-form">
      <h3>Guest Information</h3>
      
      <div class="form-row">
        <mat-form-field appearance="outline" class="form-field">
          <mat-label>First Name</mat-label>
          <input matInput formControlName="firstName" required>
          <mat-error *ngIf="hasError('firstName')">
            {{ getErrorMessage('firstName') }}
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Last Name</mat-label>
          <input matInput formControlName="lastName" required>
          <mat-error *ngIf="hasError('lastName')">
            {{ getErrorMessage('lastName') }}
          </mat-error>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Email Address</mat-label>
          <input matInput type="email" formControlName="email" required>
          <mat-error *ngIf="hasError('email')">
            {{ getErrorMessage('email') }}
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Phone Number</mat-label>
          <input matInput formControlName="phone" required>
          <mat-error *ngIf="hasError('phone')">
            {{ getErrorMessage('phone') }}
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Address fields - required for guest reservations, optional for client reservations -->
      <div *ngIf="!isLoggedIn" class="address-section">
        <h4>Address Information</h4>
        
        <mat-form-field appearance="outline" class="form-field full-width">
          <mat-label>Address</mat-label>
          <input matInput formControlName="address" required>
          <mat-error *ngIf="hasError('address')">
            {{ getErrorMessage('address') }}
          </mat-error>
        </mat-form-field>

        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>City</mat-label>
            <input matInput formControlName="city" required>
            <mat-error *ngIf="hasError('city')">
              {{ getErrorMessage('city') }}
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Country</mat-label>
            <input matInput formControlName="country" required>
            <mat-error *ngIf="hasError('country')">
              {{ getErrorMessage('country') }}
            </mat-error>
          </mat-form-field>
        </div>
      </div>

      <mat-form-field appearance="outline" class="form-field full-width">
        <mat-label>Special Requests (Optional)</mat-label>
        <textarea matInput 
                  formControlName="specialRequests" 
                  rows="3" 
                  placeholder="Any special requests or notes..."></textarea>
      </mat-form-field>
    </form>
  </div>

  <div mat-dialog-actions class="dialog-actions">
    <button mat-button 
            type="button" 
            (click)="onCancel()"
            class="cancel-button">
      Cancel
    </button>
    <button mat-raised-button 
            color="primary" 
            (click)="onSubmitReservation()"
            [disabled]="!reservationForm.valid || isSubmitting"
            class="reserve-button">
      <mat-icon *ngIf="!isSubmitting">payment</mat-icon>
      <mat-icon *ngIf="isSubmitting" class="spinner">hourglass_empty</mat-icon>
      {{ isSubmitting ? 'Processing...' : 'Proceed to Payment' }}
    </button>
  </div>
</div>
